{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h2>Claims Dashboard</h2>
    <a href="/claims/new" class="button primary">+ New Claim</a>
</div>

<div class="card">
    <form method="get" class="filters">
        <select name="status">
            <option value="">All Statuses</option>
            {% for s in statuses %}
            <option value="{{ s.value }}" {% if filters.status == s %}selected{% endif %}>{{ s.value }}</option>
            {% endfor %}
        </select>
        
        <select name="severity">
            <option value="">All Severities</option>
            {% for s in severities %}
            <option value="{{ s.value }}" {% if filters.severity == s %}selected{% endif %}>{{ s.value }}</option>
            {% endfor %}
        </select>

        <select name="type">
            <option value="">All Types</option>
            {% for t in types %}
            <option value="{{ t.value }}" {% if filters.type == t %}selected{% endif %}>{{ t.value }}</option>
            {% endfor %}
        </select>
        
        <input type="date" name="date_from" value="{{ filters.date_from or '' }}" placeholder="From">
        <input type="date" name="date_to" value="{{ filters.date_to or '' }}" placeholder="To">
        
        <input type="text" name="search" placeholder="Search..." value="{{ filters.search or '' }}" style="width: auto;">
        
        <button type="submit" class="button secondary">Filter</button>
        
        <div style="margin-left: auto;">
            <a href="/?status=Open" class="button secondary">Open Only</a>
            <a href="/?severity=High" class="button secondary">High Severity</a>
            <a href="/?range_preset=week" class="button secondary">This Week</a>
        </div>
    </form>
</div>

<div class="card">
    <div class="table-scroll">
        <table>
            <thead>
                <tr>
                    <th class="col-id">ID</th>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Severity</th>
                    <th class="col-status">Status</th>
                    <th class="col-desc">Description</th>
                    <th class="col-actions">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for claim in claims %}
                <tr>
                    <td class="col-id">{{ claim.id }}</td>
                    <td>{{ claim.created_at.strftime('%Y-%m-%d') }}</td>
                    <td>{{ claim.type.value }}</td>
                    <td><span class="severity-{{ claim.severity.value }}">{{ claim.severity.value }}</span></td>
                    <td class="col-status">
                        <a href="/claims/{{ claim.id }}" class="status-link">
                            <span class="status-{{ claim.status.name }} status-badge">{{ claim.status.value }}</span>
                        </a>
                    </td>
                    <td class="col-desc">{{ claim.description[:50] }}{% if claim.description|length > 50 %}...{% endif %}</td>
                    <td class="col-actions"><a href="/claims/{{ claim.id }}">View</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card export-panel">
    <h3>Weekly Digest Export</h3>
    <form id="exportForm" action="/export" method="post" target="_blank">
        <div class="filters">
            <input type="date" name="date_from" required>
            <input type="date" name="date_to" required>
            <button type="submit" class="button secondary">Download .md</button>
            <button type="button" class="button secondary" onclick="copyDigest()">Copy to Clipboard</button>
        </div>
    </form>
</div>
{% endblock %}
